* Grid5000 documentation required for the deployment of inference servers
** Djoser SIMEU
** Monday 24 february
+ The Hadrware page :  https://www.grid5000.fr/w/Hardware
+ The goal is to construct a deployment image to store on the g5k front end containing all thye packages required to run the TGI server on a node.(https://www.grid5000.fr/w/Environment_creation)
+ The test will be made on the drac node of the grenoble site (4 x Nvidia Tesla P100-SXM2-16GB (16 GiB)) : https://www.grid5000.fr/w/Grenoble:Hardware
  #+begin_example
  fgrenoble : oarsub -t exotic -t deploy -p drac -I -l host=1,walltime=3
  frontend : kadeploy3 debian12-big
  #+end_example
*** Installing TGI
**** With python venv
#+begin_example
git clone https://github.com/DjoserKhemSimeu/text-generation-inference.git
cd text-generation-inference
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
apt-get install python3-venv
python3 -m venv .venv
source .venv/bin/activate
PROTOC_ZIP=protoc-21.12-linux-x86_64.zip
curl -OL https://github.com/protocolbuffers/protobuf/releases/download/v21.12/$PROTOC_ZIP
unzip -o $PROTOC_ZIP -d /usr/local bin/protoc
unzip -o $PROTOC_ZIP -d /usr/local 'include/*'
rm -f $PROTOC_ZIP
apt-get install -y make
BUILD_EXTENSIONS=True make install
#+end_example
**** With nix
#+begin_example
sh <(curl -L https://nixos.org/nix/install) --daemon
apt install nix-bin
nix-env -iA cachix -f https://cachix.org/api/v1/install
cachix use text-generation-inference
nix-build copying path '/nix/store/n1gwpmvmcgsbnr0a8ncflhvc59db775h-myproject-1.0.0' from 'https://text-generation-inference.cachix.org
#+end_example
**** Docker (https://docs.docker.com/engine/install/debian/)
#+begin_example
apt update
apt install -y ca-certificates curl gnupg
install -m 0755 -d /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/debian/gpg | sudo tee /etc/apt/keyrings/docker.asc > /dev/null
chmod a+r /etc/apt/keyrings/docker.asc
echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/debian bookworm stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
sudo apt update
sudo apt install -y docker-ce docker-ce-cli containerd.io
sudo systemctl start docker
sudo systemctl enable docker
docker --version
model=teknium/OpenHermes-2.5-Mistral-7B
volume=$PWD/data
docker run --gpus all --shm-size 64g -p 8080:80 -v $volume:/data \
    ghcr.io/huggingface/text-generation-inference:3.1.0 \
    --model-id $model
#+end_example
